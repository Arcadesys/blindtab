// Firebase All-In-One Fix - Copy and paste this into your browser console
(async function(){console.group("🔧 Firebase All-In-One Fix");try{console.log("Step 1: Loading Firebase...");const e=document.createElement("script");e.src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js",document.head.appendChild(e),await new Promise(e=>{e.onload=e,setTimeout(e,2e3)});const o=document.createElement("script");if(o.src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js",document.head.appendChild(o),await new Promise(e=>{o.onload=e,setTimeout(e,2e3)}),console.log("✅ Firebase scripts loaded"),"undefined"==typeof firebase)throw new Error("Firebase not available after loading scripts");console.log("Step 2: Initializing Firebase...");let t;t=0===firebase.apps.length?firebase.initializeApp({projectId:"blindtab-db",apiKey:"AIzaSyDummyKeyForSecurity",authDomain:"blindtab-db.firebaseapp.com"}):firebase.apps[0],console.log("✅ Firebase initialized"),console.log("Step 3: Setting up Firestore...");const r=firebase.firestore();r.settings({experimentalForceLongPolling:!0,ssl:!0,host:"firestore.googleapis.com",merge:!0,ignoreUndefinedProperties:!0,cacheSizeBytes:firebase.firestore.CACHE_SIZE_UNLIMITED}),console.log("✅ Applied Firestore settings"),console.log("Step 4: Adding automatic retry for failed operations...");const n=r.collection;r.collection=function(...e){const o=n.apply(this,e),t=o.add,r=o.doc().set,s=o.doc().update,a=o.doc().delete;o.add=async function(...e){try{return await t.apply(this,e)}catch(o){if(console.error("[Firebase] Add operation failed:",o),o.message?.includes("offline")||o.message?.includes("network")||o.message?.includes("jd")||o.message?.includes("Bad Request")||o.message?.includes("400"))return console.log("[Firebase] Retrying add operation..."),await new Promise(e=>setTimeout(e,1e3)),t.apply(this,e);throw o}};const i=o.doc;return o.doc=function(...e){const o=i.apply(this,e);return o.set=async function(...e){try{return await r.apply(this,e)}catch(o){if(console.error("[Firebase] Set operation failed:",o),o.message?.includes("offline")||o.message?.includes("network")||o.message?.includes("jd")||o.message?.includes("Bad Request")||o.message?.includes("400"))return console.log("[Firebase] Retrying set operation..."),await new Promise(e=>setTimeout(e,1e3)),r.apply(this,e);throw o}},o.update=async function(...e){try{return await s.apply(this,e)}catch(o){if(console.error("[Firebase] Update operation failed:",o),o.message?.includes("offline")||o.message?.includes("network")||o.message?.includes("jd")||o.message?.includes("Bad Request")||o.message?.includes("400"))return console.log("[Firebase] Retrying update operation..."),await new Promise(e=>setTimeout(e,1e3)),s.apply(this,e);throw o}},o.delete=async function(...e){try{return await a.apply(this,e)}catch(o){if(console.error("[Firebase] Delete operation failed:",o),o.message?.includes("offline")||o.message?.includes("network")||o.message?.includes("jd")||o.message?.includes("Bad Request")||o.message?.includes("400"))return console.log("[Firebase] Retrying delete operation..."),await new Promise(e=>setTimeout(e,1e3)),a.apply(this,e);throw o}},o},o},console.log("✅ Added automatic retry for failed operations"),console.log("Step 5: Testing connection...");try{const e=r.collection("_test_connection"),o=e.doc("_test_"+Date.now());await o.set({test:!0,timestamp:Date.now()}),console.log("✅ Write test successful");await o.get(),console.log("✅ Read test successful"),await o.delete(),console.log("✅ Delete test successful"),console.log("✅ Connection tests passed")}catch(e){console.error("❌ Connection test failed:",e),console.log("⚠️ Firebase may still work, but connection test failed")}window.db=r,window._fixed_db=r,window._firebase_app=t,console.log("✅ Fix applied successfully!"),console.log("🔄 Refresh the page to use the fixed Firebase")}catch(e){console.error("❌ Error applying Firebase fix:",e),console.log("Try refreshing the page and running the script again")}console.groupEnd()})(); 