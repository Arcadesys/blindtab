<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Simple Fix</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #333;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .button {
      background-color: #4285f4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
    }
    .button:hover {
      background-color: #3367d6;
    }
    .code-block {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    .instructions {
      background-color: #e8f0fe;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <h1>Firebase Simple Fix</h1>
  
  <div class="instructions">
    <h2>Firebase Namespace Fix</h2>
    <p>This fix loads Firebase directly and applies the correct settings. Copy and paste this into your browser console:</p>
    <div class="code-block">
      <button class="button" onclick="copyNamespaceFix()">Copy Namespace Fix</button>
      <pre id="namespace-fix">(function(){console.group("üîß Firebase Namespace Fix");try{if("undefined"==typeof firebase){console.error("‚ùå Firebase namespace not found. Loading Firebase...");const e=e=>new Promise((o,n)=>{const s=document.createElement("script");s.src=e,s.onload=o,s.onerror=n,document.head.appendChild(s)});e("https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js").then(()=>e("https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js")).then(()=>{console.log("‚úÖ Firebase loaded successfully"),o()}).catch(e=>{console.error("‚ùå Failed to load Firebase:",e)})}else console.log("‚úÖ Firebase namespace found"),o();function o(){firebase.apps.length||(firebase.initializeApp({projectId:"blindtab-db",apiKey:"AIzaSyDummyKeyForSecurity",authDomain:"blindtab-db.firebaseapp.com"}),console.log("‚úÖ Firebase initialized"));const e=firebase.firestore();e.settings({experimentalForceLongPolling:!0,merge:!0,ssl:!0,host:"firestore.googleapis.com",ignoreUndefinedProperties:!0,cacheSizeBytes:firebase.firestore.CACHE_SIZE_UNLIMITED}),console.log("‚úÖ Applied Firestore settings to fix WebChannel issues"),window.db=e,window._fixed_db=e,console.log("‚úÖ Fix applied successfully")}}catch(e){console.error("‚ùå Error applying Firebase namespace fix:",e)}console.groupEnd()})();</pre>
    </div>
  </div>
  
  <div class="instructions">
    <h2>Super Simple Fix</h2>
    <p>If the above fix doesn't work, try this ultra-simple fix that just loads Firebase and sets it up:</p>
    <div class="code-block">
      <button class="button" onclick="copySuperSimpleFix()">Copy Super Simple Fix</button>
      <pre id="super-simple-fix">(async function() {
  console.log('üîß Loading Firebase...');
  
  // Load Firebase scripts
  const app = document.createElement('script');
  app.src = 'https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js';
  document.head.appendChild(app);
  
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  const firestore = document.createElement('script');
  firestore.src = 'https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js';
  document.head.appendChild(firestore);
  
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  console.log('‚úÖ Firebase loaded');
  
  // Initialize Firebase
  firebase.initializeApp({
    projectId: 'blindtab-db',
    apiKey: 'AIzaSyDummyKeyForSecurity',
    authDomain: 'blindtab-db.firebaseapp.com'
  });
  
  // Get Firestore
  const db = firebase.firestore();
  
  // Apply settings
  db.settings({
    experimentalForceLongPolling: true,
    ssl: true,
    host: 'firestore.googleapis.com'
  });
  
  // Expose to window
  window.db = db;
  window._fixed_db = db;
  
  console.log('‚úÖ Fix applied! Refresh the page to use the fixed Firebase.');
})();</pre>
    </div>
  </div>
  
  <div class="instructions">
    <h2>Permanent Fix</h2>
    <p>To permanently fix the issue, update your firebase.ts file with this code:</p>
    <div class="code-block">
      <button class="button" onclick="copyPermanentFix()">Copy Permanent Fix</button>
      <pre id="permanent-fix">// For production, use these settings
db = initializeFirestore(app, {
  localCache: persistentLocalCache({
    tabManager: persistentMultipleTabManager(),
    cacheSizeBytes: CACHE_SIZE_UNLIMITED
  }),
  // These settings fix the WebChannel connection issue
  experimentalForceLongPolling: true,
  experimentalAutoDetectLongPolling: false, // Force long polling only
  ssl: true,
  ignoreUndefinedProperties: true
});

// Apply additional settings to fix WebChannel connection issues
try {
  // @ts-ignore - This is a workaround for Firebase WebChannel connection issues
  db._settings = {
    // @ts-ignore
    ...db._settings,
    host: 'firestore.googleapis.com',
    ssl: true
  };
  console.log('[Firebase] Applied additional connection settings for production');
} catch (error) {
  console.error('[Firebase] Failed to apply additional settings:', error);
}</pre>
    </div>
  </div>
  
  <script>
    function copyNamespaceFix() {
      const content = document.getElementById('namespace-fix').textContent;
      navigator.clipboard.writeText(content)
        .then(() => alert('Namespace fix copied to clipboard!'))
        .catch(err => console.error('Failed to copy: ', err));
    }
    
    function copySuperSimpleFix() {
      const content = document.getElementById('super-simple-fix').textContent;
      navigator.clipboard.writeText(content)
        .then(() => alert('Super simple fix copied to clipboard!'))
        .catch(err => console.error('Failed to copy: ', err));
    }
    
    function copyPermanentFix() {
      const content = document.getElementById('permanent-fix').textContent;
      navigator.clipboard.writeText(content)
        .then(() => alert('Permanent fix copied to clipboard!'))
        .catch(err => console.error('Failed to copy: ', err));
    }
  </script>
</body>
</html> 